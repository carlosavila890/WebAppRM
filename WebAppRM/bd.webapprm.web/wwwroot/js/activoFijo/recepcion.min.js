var objName={nameNumeroClaveCatastral:"NumeroClaveCatastral",nameNumeroChasis:"NumeroChasis",nameNumeroMotor:"NumeroMotor",namePlaca:"Placa",nameSerie:"Serie"},objCategorias={Edificio:"Edificios",MueblesEnseres:"Muebles y enseres",EquiposOficina:"Equipos de oficina",Vehiculo:"Vehículos",EquiposComputoSoftware:"Equipos de cómputo y software"},arrIdsfilas=Array();function gestionarWizard(){var a=$(".wizard").wizard();a.on("finished.fu.wizard",function(a,o){if(!validarWizard())return!1;$("#checkout-form").submit()}),a.on("change.fu.wizard",function(a,o){if("previous"!==o.direction){var e;if(e=validarWizard())if(2==o.step)(e=validarDatosEspecificosPertenecenBodegaEmpleadoCodigosecuencial())||(mostrarNotificacion("Error","Tiene que asignar cada dato específico a una Bodega o Empleado y a un Código secuencial."),$("#spanError").html("El modelo es inválido."));else if(3==o.step&&isEditar)return $("#checkout-form").submit(),!1;return e}})}function generarCodigosecuencial(){return $("#CodigoActivoFijo_SUBCAF").val($("#ActivoFijo_IdSubClaseActivoFijo").val()),$("#CodigoActivoFijo_CAF").val($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),$("#CodigoActivoFijo_SUC").val($("#LibroActivoFijo_IdSucursal").val()),$("#LibroActivoFijo_IdSucursal").val()+"."+(agregarCeros($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val(),3)+".")+(agregarCeros($("#ActivoFijo_IdSubClaseActivoFijo").val(),3)+".")}function validarWizard(){return $("#checkout-form").valid()?($("#spanError").html(""),!0):(mostrarNotificacion("Error","Existen errores en el formulario."),$("#spanError").html("El modelo es inválido."),!1)}function eventoTipoActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").on("change",function(a){partialViewTipoActivoFijo(a.val)})}function eventoClaseActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").on("change",function(a){partialViewClaseActivoFijo(a.val)})}function eventoMarca(){$("#ActivoFijo_Modelo_IdMarca").on("change",function(a){mostrarLoadingPanel("checkout-form","Cargando modelos..."),$.ajax({url:urlModeloSelectResult,method:"POST",data:{idMarca:a.val},success:function(a){$("#div_modelo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})})}function eventoRamo(){$("#ActivoFijo_PolizaSeguroActivoFijo_Subramo_IdRamo").on("change",function(a){mostrarLoadingPanel("checkout-form","Cargando subramos..."),$.ajax({url:urlSubramoSelectResult,method:"POST",data:{idRamo:a.val},success:function(a){$("#div_subramo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})})}function eventoSucursal(){$("#LibroActivoFijo_IdSucursal").on("change",function(a){partialViewLibroActivoFijo(a.val)})}function partialViewLibroActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando libros de activo fijo..."),$.ajax({url:libroActivoFijoSelectResult,method:"POST",data:{idSucursal:obtenerIdAjax(a)},success:function(a){$("#div_libroActivoFijo").html(a),Init_Select2()},complete:function(a){clearDatosEspecificosBodegaEmpleado(),$("#checkout-form").waitMe("hide")}})}function partialViewTipoActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando clases de activo fijo..."),$.ajax({url:claseActivoFijoSelectResult,method:"POST",data:{idTipoActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_claseActivoFijo").html(a),Init_Select2()},error:function(a){$("#checkout-form").waitMe("hide")},complete:function(a){partialViewClaseActivoFijo($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),eventoClaseActivoFijo()}})}function partialViewClaseActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando subclases de activo fijo..."),$.ajax({url:subClaseActivoFijoSelectResult,method:"POST",data:{idClaseActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_subClaseActivoFijo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide"),obtenerCategoria(function(){eventoCambiarCategoria()})}})}function eventoSpinnerCantidad(){$(".spinnerCantidad").spinner("delay",200).spinner("changed",function(a,o,e){o>arrIdsfilas.length?(crearFilas(o-arrIdsfilas.length),$.each($(".btnEliminarDatosEspecificos"),function(a,o){$(o).removeClass("hide")})):eliminarFilas(arrIdsfilas.length-o)})}function obtenerCategoria(a){mostrarLoadingPanel("tbDatosEspecificos","Cargando datos por categoría..."),$.ajax({url:urlCategoria,method:"POST",data:{idClaseActivoFijo:$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()},success:function(a){categoria=a},error:function(){categoria=""},complete:function(o){a&&a(),$("#tbDatosEspecificos").waitMe("hide")}})}function initArrIdFilas(){for(var a=0;a<maxIdFila;a++)arrIdsfilas.push(a)}function crearFilas(a){for(var o=0;o<a;o++){var e=arrIdsfilas.length,i="<input type='hidden' id='h"+objName.nameNumeroClaveCatastral+"_"+e+"'name='h"+objName.nameNumeroClaveCatastral+"_"+e+"'/>",t="<input type='hidden' id='h"+objName.nameNumeroChasis+"_"+e+"'name='h"+objName.nameNumeroChasis+"_"+e+"'/>",r="<input type='hidden' id='h"+objName.nameNumeroMotor+"_"+e+"'name='h"+objName.nameNumeroMotor+"_"+e+"'/>",c="<input type='hidden' id='h"+objName.namePlaca+"_"+e+"'name='h"+objName.namePlaca+"_"+e+"'/>",l="<input type='hidden' id='h"+objName.nameSerie+"_"+e+"'name='h"+objName.nameSerie+"_"+e+"'/>",s="<input type='hidden' id='hBodega_"+e+"'name='hBodega_"+e+"'/>",n="<input type='hidden' id='hEmpleado_"+e+"'name='hEmpleado_"+e+"'/>",d="<input type='hidden' id='hIdRecepcionActivoFijoDetalle_"+e+"' name='hIdRecepcionActivoFijoDetalle_"+e+"' />",m="<input type='hidden' id='hUbicacion_"+e+"' name='hUbicacion_"+e+"' />",u="<input type='hidden' id='hComponentes_"+e+"' name='hComponentes_"+e+"' />",f="<input type='hidden' id='hCodigoSecuencial_"+e+"' name='hCodigoSecuencial_"+e+"' />",p="<a href='javascript: void(0);' onclick='cargarFormularioDatosEspecificos("+e+")' class='btnEditarDatosEspecificos' data-idfila='"+e+"' data-toggle='modal' data-target='#myModal'>Editar</a>",v="<span> | </span><a href='javascript: void(0);' onclick='cargarFormularioCodificacion("+e+")' class='btnEditarCodificacion' data-idfila='"+e+"' data-toggle='modal' data-target='#myModal'>Codificaci&oacute;n</a>",C="<span> | </span><a href='javascript: void(0);' onclick='cargarFormularioComponentesDatosEspecificos("+e+")' class='btnComponentesDatosEspecificos' data-idfila='"+e+"' data-idorigen='' data-idscomponentes='' data-toggle='modal' data-target='#myModalComponente'>Componentes</a>",h="<div id='divEliminarDatosEspecificos_"+e+"' class='btnEliminarDatosEspecificos"+(0==arrIdsfilas.length?" hide":"")+"' style='display:inline;'><span> | </span><a href='javascript: void(0);' id='btnEliminarDatosEspecifico_"+e+"' onclick=abrirVentanaConfirmacion('btnEliminarDatosEspecifico_"+e+"') data-funcioncallback='callBackFunctionEliminarDatoEspecifico("+e+")' data-titulo='Eliminar' data-descripcion='&#191; Desea eliminar el Dato Espec&iacute; fico... ?'>Eliminar</a>";mostrarOcultarColumnas([!0,!0,!0,!0,!0]),addRowTableDatosEspecificos(["-","-","-","-","-","-","-","-",i+t+r+c+l+s+n+d+m+u+f+p+v+C+h],e,[objName.nameNumeroClaveCatastral,objName.nameNumeroChasis,objName.nameNumeroMotor,objName.namePlaca,objName.nameSerie,"Bodega","Empleado","Codificacion"]),eventoCambiarCategoria(),arrIdsfilas.push(e),addComponenteToArray(e,0,[])}}function addRowTableDatosEspecificos(a,o,e){var i=$("#tbDatosEspecificos").DataTable().row.add(a).draw().node();$(i).prop("id","trDatosEspecificos_"+o),$.each($(i).children(),function(a,i){a<e.length&&$(i).prop("id","td"+e[a]+"_"+o)})}function deleteRowTableDatosEspecificos(a){var o=$("#trDatosEspecificos_"+a);$("#tbDatosEspecificos").dataTable().fnDeleteRow(o)}function eliminarFilas(a){for(var o=arrIdsfilas.length-1;a>0;){var e=arrIdsfilas[o];deleteRowTableDatosEspecificos(e),arrIdsfilas.splice(o,1),eliminarComponente(e),o--,a--}}function obtenerPosIdFila(a){for(var o=0;o<arrIdsfilas.length;o++)if(arrIdsfilas[o]==a)return o}function eventoCambiarCategoria(){categoria==objCategorias.Edificio?mostrarOcultarColumnas([!0,!1,!1,!1,!1]):categoria==objCategorias.Vehiculo?mostrarOcultarColumnas([!1,!0,!0,!0,!1]):categoria==objCategorias.EquiposComputoSoftware?mostrarOcultarColumnas([!1,!1,!1,!1,!0]):mostrarOcultarColumnas([!1,!1,!1,!1,!1])}function mostrarOcultarColumnas(a){for(var o=$("#tbDatosEspecificos").DataTable(),e=0;e<a.length;e++)o.column(e).visible(a[e])}function cargarFormularioDatosEspecificos(a){mostrarLoadingPanel("modalContentDatosEspecificos","Cargando datos, por favor espere..."),$("#hIdFilaModalDatosEspecificos").val(a),$("#hIdRecepcionActivoFijoDetalle").val($("#hIdRecepcionActivoFijoDetalle_"+a).val()),$("#hIdUbicacionActivoFijo").val($("#hUbicacion_"+a).val()),$("#myModalLabel").html("Editar"),$("#btnGuardarDatosEspecificos").data("funcioncallback","guardarDatosEspecificos()");var o=new Object;categoria==objCategorias.Edificio?o.NumeroClaveCatastral=$("#h"+objName.nameNumeroClaveCatastral+"_"+a).val():categoria==objCategorias.Vehiculo?(o.NumeroChasis=$("#h"+objName.nameNumeroChasis+"_"+a).val(),o.NumeroMotor=$("#h"+objName.nameNumeroMotor+"_"+a).val(),o.Placa=$("#h"+objName.namePlaca+"_"+a).val()):categoria==objCategorias.EquiposComputoSoftware&&(o.Serie=$("#h"+objName.nameSerie+"_"+a).val()),o.IdBodega=$("#hBodega_"+a).val(),o.IdEmpleado=$("#hEmpleado_"+a).val(),$.ajax({url:urlModalDatosEspecificosResult,method:"POST",data:{rafd:o,categoria:categoria,idSucursal:$("#LibroActivoFijo_IdSucursal").val(),idBodega:o.IdBodega,idEmpleado:o.IdEmpleado},success:function(a){$("#modalBodyDatosEspecificos").html(a),Init_Select2(),eventoRadioDatosEspecificos()},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario.")},complete:function(a){$("#modalContentDatosEspecificos").waitMe("hide")}})}function eventoRadioDatosEspecificos(){$(".radioDatosEspecificos").on("change",function(a){switch($(a.currentTarget).data("ubicacion")){case"Bodega":$("#divDatosEspecificosEmpleado").addClass("hide"),$("#divDatosEspecificosBodega").removeClass("hide");break;default:$("#divDatosEspecificosBodega").addClass("hide"),$("#divDatosEspecificosEmpleado").removeClass("hide")}})}function eventoGuardarDatosEspecificos(){$("#btnGuardarDatosEspecificos").on("click",function(e){var funcionCallback=$("#btnGuardarDatosEspecificos").data("funcioncallback");eval(funcionCallback)})}function guardarDatosEspecificos(){mostrarLoadingPanel("modalContentDatosEspecificos","Validando datos, por favor espere..."),$.each($(".validationDatosEspecificos"),function(a,o){$(o).html("")});var a=new Object;categoria==objCategorias.Edificio?a.NumeroClaveCatastral=$("#"+objName.nameNumeroClaveCatastral).val():categoria==objCategorias.Vehiculo?(a.NumeroChasis=$("#"+objName.nameNumeroChasis).val(),a.NumeroMotor=$("#"+objName.nameNumeroMotor).val(),a.Placa=$("#"+objName.namePlaca).val()):categoria==objCategorias.EquiposComputoSoftware&&(a.Serie=$("#"+objName.nameSerie).val()),a.IdFila=$("#hIdFilaModalDatosEspecificos").val(),a.IdRecepcionActivoFijoDetalle=$("#hIdRecepcionActivoFijoDetalle").val(),a.IdBodega=$("#IdBodega").val(),a.IdEmpleado=$("#IdEmpleado").val(),a.IsBodega=$("#radioBodegaDatosEspecificos").prop("checked"),validarDatosEspecificosExisten(a)?$.ajax({url:urlValidacionDatosEspecificosResult,method:"POST",data:{rafd:a},success:function(o){if(o.length>0)$.each(o,function(a,o){$("#val"+o.propiedad).html(o.valor)});else{var e=$("#hIdFilaModalDatosEspecificos").val(),i=$("#tbDatosEspecificos").DataTable();if(categoria==objCategorias.Edificio?(i.cell($("#td"+objName.nameNumeroClaveCatastral+"_"+e)).data(formatearDatosEspecifico(a.NumeroClaveCatastral)).draw(),$("#h"+objName.nameNumeroClaveCatastral+"_"+e).val(a.NumeroClaveCatastral)):categoria==objCategorias.Vehiculo?(i.cell($("#td"+objName.nameNumeroChasis+"_"+e)).data(formatearDatosEspecifico(a.NumeroChasis)).draw(),$("#h"+objName.nameNumeroChasis+"_"+e).val(a.NumeroChasis),i.cell($("#td"+objName.nameNumeroMotor+"_"+e)).data(formatearDatosEspecifico(a.NumeroMotor)).draw(),$("#h"+objName.nameNumeroMotor+"_"+e).val(a.NumeroMotor),i.cell($("#td"+objName.namePlaca+"_"+e)).data(formatearDatosEspecifico(a.Placa)).draw(),$("#h"+objName.namePlaca+"_"+e).val(a.Placa)):categoria==objCategorias.EquiposComputoSoftware&&(i.cell($("#td"+objName.nameSerie+"_"+e)).data(formatearDatosEspecifico(a.Serie)).draw(),$("#h"+objName.nameSerie+"_"+e).val(a.Serie)),a.IsBodega)if($("#chkTodosBodegasDatosEspecificos").prop("checked"))for(var t=0;t<arrIdsfilas.length;t++)putDatoBodegaEmpleadoFila(arrIdsfilas[t],"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[t],"Empleado","-","");else putDatoBodegaEmpleadoFila(e,"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(e,"Empleado","-","");else if($("#chkTodosEmpleadosDatosEspecificos").prop("checked"))for(t=0;t<arrIdsfilas.length;t++)putDatoBodegaEmpleadoFila(arrIdsfilas[t],"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[t],"Bodega","-","");else putDatoBodegaEmpleadoFila(e,"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(e,"Bodega","-","");$("#btnCancelarDatosEspecificos").click()}},error:function(a){mostrarNotificacion("Error","Ocurrió un error al validar el formulario.")},complete:function(a){$("#modalContentDatosEspecificos").waitMe("hide")}}):$("#modalContentDatosEspecificos").waitMe("hide")}function formatearDatosEspecifico(a){return""==(a=a.toString().trim())&&(a="-"),a}function clearDatosEspecificosBodegaEmpleado(){for(var a=0;a<arrIdsfilas.length;a++)putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Bodega","-",""),putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Empleado","-","")}function putDatoBodegaEmpleadoFila(a,o,e,i){$("#tbDatosEspecificos").DataTable().cell($("#td"+o+"_"+a)).data(e).draw(),$("#h"+o+"_"+a).val(i)}function validarDatosEspecificosPertenecenBodegaEmpleadoCodigosecuencial(){for(var a=0;a<arrIdsfilas.length;a++){var o=arrIdsfilas[a],e=$("#hBodega_"+o).val(),i=$("#hEmpleado_"+o).val(),t=$("#hCodigoSecuencial_"+o).val();if((""==e||null==e)&&(""==i||null==i)||""==t||null==t)return!1}return!0}function validarDatosEspecificosExisten(a){for(var o=0;o<arrIdsfilas.length;o++){var e=arrIdsfilas[o];if(a.IdFila!=e)if(categoria==objCategorias.Edificio){if(a.NumeroClaveCatastral==$("#td"+objName.nameNumeroClaveCatastral+"_"+e).html())return $("#val"+objName.nameNumeroClaveCatastral).html("El Número de clave catastral: ya existe."),!1}else if(categoria==objCategorias.Vehiculo){var i=!0;if(a.NumeroChasis==$("#td"+objName.nameNumeroChasis+"_"+e).html()&&($("#val"+objName.nameNumeroChasis).html("El Número de chasis: ya existe."),i=!1),a.NumeroMotor==$("#td"+objName.nameNumeroMotor+"_"+e).html()&&($("#val"+objName.nameNumeroMotor).html("El Número de motor: ya existe."),i=!1),a.Placa==$("#td"+objName.namePlaca+"_"+e).html()&&($("#val"+objName.namePlaca).html("La Placa: ya existe."),i=!1),!i)return!1}else if(categoria==objCategorias.EquiposComputoSoftware&&a.Serie==$("#td"+objName.nameSerie+"_"+e).html())return $("#val"+objName.nameSerie).html("La Serie: ya existe."),!1}return!0}function callBackFunctionEliminarDatoEspecifico(a){var o=obtenerPosIdFila(a);deleteRowTableDatosEspecificos(o),arrIdsfilas.splice(o,1),eliminarComponente(a),$("#RecepcionActivoFijo_Cantidad").val(arrIdsfilas.length),1==arrIdsfilas.length&&$("#divEliminarDatosEspecificos_"+arrIdsfilas[0]).addClass("hide")}function cargarFormularioCodificacion(a){mostrarLoadingPanel("modalContentDatosEspecificos","Cargando datos, por favor espere..."),$("#hIdFilaModalDatosEspecificos").val(a),$("#hIdRecepcionActivoFijoDetalle").val($("#hIdRecepcionActivoFijoDetalle_"+a).val()),$("#myModalLabel").html("Codificaci&oacute;n"),$("#btnGuardarDatosEspecificos").data("funcioncallback","guardarCodificacion()");var o=$("#hCodigoSecuencial_"+a).val(),e=1;if(""!=o&&null!=o)try{var i=o.split(".");e=i[i.length-1]}catch(a){}$.ajax({url:urlCodificacion,method:"POST",data:{Codigosecuencial:$("#hCodigoSecuencial_"+a).val()},success:function(a){$("#modalBodyDatosEspecificos").html(a),$("#CodigoActivoFijo_Consecutivo").val(e),$(".spinnerNumeroConsecutivo").spinner(),$("#spanCodigoSecuencial").html(generarCodigosecuencial()),generarNumeroConsecutivo(),asignarCodigoBarras(),eventoSpinnerNumeroConsecutivo()},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario.")},complete:function(a){$("#modalContentDatosEspecificos").waitMe("hide")}})}function guardarCodificacion(){mostrarLoadingPanel("modalContentDatosEspecificos","Validando datos, por favor espere..."),$.each($(".validationCodificacion"),function(a,o){$(o).html("")});var a={IdFila:$("#hIdFilaModalDatosEspecificos").val(),IdRecepcionActivoFijoDetalle:$("#hIdRecepcionActivoFijoDetalle").val(),Codigosecuencial:$("#spanCodigoSecuencial").html()+$("#spanNumeroConsecutivo").html(),IdCodigoActivoFijo:$("#hIdCodigoActivoFijo_").val()};validarCodificacionNoExiste(a)?$.ajax({url:urlValidarCodigoUnico,method:"POST",data:{idCodigoActivoFijo:a.IdCodigoActivoFijo,codigoSecuencial:a.Codigosecuencial},success:function(o){"false"==o.toString().toLowerCase()?($("#tbDatosEspecificos").DataTable().cell($("#tdCodificacion_"+a.IdFila)).data(a.Codigosecuencial).draw(),$("#hCodigoSecuencial_"+a.IdFila).val(a.Codigosecuencial),$("#btnCancelarDatosEspecificos").click()):$("#valConsecutivo").html("El Código secuencial: ya existe.")},error:function(a){mostrarNotificacion("Error","Ocurrió un error al validar el formulario.")},complete:function(a){$("#modalContentDatosEspecificos").waitMe("hide")}}):$("#modalContentDatosEspecificos").waitMe("hide")}function validarCodificacionNoExiste(a){for(var o=0;o<arrIdsfilas.length;o++){var e=arrIdsfilas[o];if(a.IdFila!=e&&a.Codigosecuencial==$("#hCodigoSecuencial_"+e).val())return $("#valConsecutivo").html("El Código secuencial: ya existe."),!1}return!0}$(document).ready(function(){Init_Select2(),Init_Touchspin(),eventoTipoActivoFijo(),eventoClaseActivoFijo(),eventoMarca(),eventoRamo(),eventoSucursal(),gestionarWizard(),Init_DatetimePicker("RecepcionActivoFijo_FechaRecepcion"),Init_FileInput("file"),eventoSpinnerCantidad(),initArrIdFilas(),eventoRadioDatosEspecificos(),eventoGuardarDatosEspecificos(),initDataTableFiltrado("tbDatosEspecificos",[]),isEditar?eventoCambiarCategoria():obtenerCategoria(function(){crearFilas(1),eventoCambiarCategoria()}),$(".ColVis").hide()});