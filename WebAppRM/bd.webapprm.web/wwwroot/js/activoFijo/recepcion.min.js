var categoria=3,arrIdsfilas=Array();function gestionarWizard(){var a=$(".wizard").wizard();a.on("finished.fu.wizard",function(a,e){if(!validarWizard())return!1;$("#checkout-form").submit()}),a.on("change.fu.wizard",function(a,e){if("previous"!==e.direction){if(o=validarWizard())if(2==e.step){var o;(o=validarDatosEspecificosPertenecenBodegaoEmpleado())||(mostrarNotificacion("Error","Tiene que asignar cada dato específico al menos a una Bodega o Empleado."),$("#spanError").html("El modelo es inválido."))}else{if(3==e.step&&isEditar)return $("#checkout-form").submit(),!1;if(1==e.step){$("#ActivoFijo_CodigoActivoFijo_SUBCAF").val($("#ActivoFijo_IdSubClaseActivoFijo").val()),$("#ActivoFijo_CodigoActivoFijo_CAF").val($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),$("#ActivoFijo_CodigoActivoFijo_SUC").val($("#LibroActivoFijo_IdSucursal").val());var i=$("#LibroActivoFijo_IdSucursal").val()+". ",t=agregarCeros($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val(),3)+". ",r=agregarCeros($("#ActivoFijo_IdSubClaseActivoFijo").val(),3)+". ";$("#spanCodigoSecuencial").html(i+t+r),generarNumeroConsecutivo()}}return o}})}function generarNumeroConsecutivo(){var a=$("#ActivoFijo_CodigoActivoFijo_Consecutivo").val();$("#spanNumeroConsecutivo").html(a)}function eventoSpinnerNumeroConsecutivo(){$(".spinnerNumeroConsecutivo").spinner("delay",200).spinner("changed",function(a,e,o){generarNumeroConsecutivo()})}function validarWizard(){return $("#checkout-form").valid()?($("#spanError").html(""),!0):(mostrarNotificacion("Error","Existen errores en el formulario."),$("#spanError").html("El modelo es inválido."),!1)}function configurarDropzone(){var a="image/*,.pdf,.xlsx,.xls,.txt,.docx,.doc";$("#spanExtensionesPermitidas").html(a),Dropzone.autoDiscover=!1,$("#mydropzone").dropzone({acceptedFiles:a,addRemoveLinks:!0,uploadMultiple:!0,parallelUploads:100,paramName:"file",autoProcessQueue:!1,createImageThumbnails:!0,maxThumbnailFilesize:10,maxFilesize:10,dictDefaultMessage:'<span class="text-center"><span class="font-lg visible-xs-block visible-sm-block visible-lg-block"><span class="font-xs"><i class="fa fa-caret-right text-danger"></i> Guardar documentaci&oacute;n o fotograf&iacute;as </span><span>&nbsp&nbsp<h4 class="display-inline"> (Haga clic)</h4></span>',dictResponseError:"¡Error subiendo archivo!",dictRemoveFile:"Eliminar archivo",dictFileTooBig:"El archivo es muy grande ({{filesize}} MB). Tamaño máximo permitido: {{maxFilesize}} MB.",dictInvalidFileType:"El archivo no está permitido.",dictResponseError:"Error {{statusCode}} al intentar subir el archivo.",dictCancelUpload:"Cancelar archivo",dictCancelUploadConfirmation:"¿Desea cancelar la subida del archivo?",dictMaxFilesExceeded:"Ha excedido el número de archivos a subir ({{maxFiles}} ficheros).",init:function(){this.on("removedfile",function(a,e){$.ajax({url:urlEliminarActivoFijo,method:"POST",data:{fileName:a.name,dir:$("#dir").val()},error:function(e){mostrarNotificacion("Error","No se pudo eliminar o no se encontró el archivo "+a.name+".")}})}),this.on("success",function(a,e){$("#dir").val(e.value),$("#nombreCarpeta").val(e.value)}),this.on("error",function(a,e){this.removeFile(a),mostrarNotificacion("Error","El sistema no tiene permisos suficientes para guardar la información.")})}})}function eventoTipoActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_ClaseActivoFijo_IdTipoActivoFijo").on("change",function(a){partialViewTipoActivoFijo(a.val)})}function eventoClaseActivoFijo(){$("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").on("change",function(a){partialViewClaseActivoFijo(a.val)})}function eventoMarca(){$("#ActivoFijo_Modelo_IdMarca").on("change",function(a){mostrarLoadingPanel("checkout-form","Cargando modelos..."),$.ajax({url:urlModeloSelectResult,method:"POST",data:{idMarca:a.val},success:function(a){$("#div_modelo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})})}function eventoRamo(){$("#ActivoFijo_PolizaSeguroActivoFijo_Subramo_IdRamo").on("change",function(a){mostrarLoadingPanel("checkout-form","Cargando subramos..."),$.ajax({url:urlSubramoSelectResult,method:"POST",data:{idRamo:a.val},success:function(a){$("#div_subramo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})})}function eventoSucursal(){$("#LibroActivoFijo_IdSucursal").on("change",function(a){partialViewLibroActivoFijo(a.val)})}function partialViewLibroActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando libros de activo fijo..."),$.ajax({url:libroActivoFijoSelectResult,method:"POST",data:{idSucursal:obtenerIdAjax(a)},success:function(a){$("#div_libroActivoFijo").html(a),Init_Select2()},complete:function(a){clearDatosEspecificosBodegaEmpleado(),$("#checkout-form").waitMe("hide")}})}function partialViewTipoActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando clases de activo fijo..."),$.ajax({url:claseActivoFijoSelectResult,method:"POST",data:{idTipoActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_claseActivoFijo").html(a),Init_Select2()},error:function(a){$("#checkout-form").waitMe("hide")},complete:function(a){partialViewClaseActivoFijo($("#ActivoFijo_SubClaseActivoFijo_IdClaseActivoFijo").val()),eventoClaseActivoFijo()}})}function partialViewClaseActivoFijo(a){mostrarLoadingPanel("checkout-form","Cargando subclases de activo fijo..."),$.ajax({url:subClaseActivoFijoSelectResult,method:"POST",data:{idClaseActivoFijo:obtenerIdAjax(a)},success:function(a){$("#div_subClaseActivoFijo").html(a),Init_Select2()},complete:function(a){$("#checkout-form").waitMe("hide")}})}function eventoSpinnerCantidad(){$(".spinnerCantidad").spinner("delay",200).spinner("changed",function(a,e,o){e>arrIdsfilas.length?(crearFilas(e-arrIdsfilas.length),$.each($(".btnEliminarDatosEspecificos"),function(a,e){$(e).removeClass("hide")})):eliminarFilas(arrIdsfilas.length-e)})}function obtenerCategoria(){return categoria=parseInt($("#IdCategoria").val())}function initArrIdFilas(){for(var a=0;a<maxIdFila;a++)arrIdsfilas.push(a)}function crearFilas(a){obtenerCategoria();for(var e=0;e<a;e++){var o="",i=arrIdsfilas.length;switch(categoria){case 1:o=crearColumnaVaciaInmueble();break;case 2:o=crearColumnaVaciaVehiculo(i);break;default:o=crearColumnaVaciaOtro(i)}var t="<td id='tdBodega_"+i+"'><span id='spanBodega_"+i+"'>-</span><input type='hidden' id='hBodega_"+i+"'name='hBodega_"+i+"'/></td>",r="<td id='tdEmpleado_"+i+"'><span id='spanEmpleado_"+i+"'>-</span><input type='hidden' id='hEmpleado_"+i+"'name='hEmpleado_"+i+"'/></td>",s="<td><input type='hidden' id='hIdRecepcionActivoFijoDetalle_"+i+"' name='hIdRecepcionActivoFijoDetalle_"+i+"' /><input type='hidden' id='hUbicacion_"+i+"' name='hUbicacion_"+i+"' /><input type='hidden' id='hComponentes_"+i+"' name='hComponentes_"+i+"' /><a href='javascript: void(0);' onclick='cargarFormularioDatosEspecificos("+i+")' class='btnEditarDatosEspecificos' data-idfila='"+i+"' data-toggle='modal' data-target='#myModal'>Editar</a>",c="<span> | </span><a href='javascript: void(0);' onclick='cargarFormularioComponentesDatosEspecificos("+i+")' class='btnComponentesDatosEspecificos' data-idfila='"+i+"' data-idorigen='' data-idscomponentes='' data-toggle='modal' data-target='#myModalComponente'>Componentes</a>",l="<div id='divEliminarDatosEspecificos_"+i+"' class='btnEliminarDatosEspecificos' style='display:inline;'><span> | </span><a href='javascript: void(0);' id='btnEliminarDatosEspecifico_"+i+"' onclick=abrirVentanaConfirmacion('btnEliminarDatosEspecifico_"+i+"') data-funcioncallback='callBackFunctionEliminarDatoEspecifico("+i+")' data-titulo='Eliminar' data-descripcion='&#191; Desea eliminar el Dato Espec&iacute; fico... ?'>Eliminar</a></div>";$("#tBodyDatosEspecificos").append("<tr id='trDatosEspecificos_"+i+"'>"+o+t+r+s+c+l+"</td></tr>"),arrIdsfilas.push(i),addComponenteToArray(i,0,[])}}function eliminarFilas(a){for(var e=arrIdsfilas.length-1;a>0;){var o=arrIdsfilas[e];$("#trDatosEspecificos_"+o).remove(),arrIdsfilas.splice(e,1),eliminarComponente(o),e--,a--}}function obtenerPosIdFila(a){for(var e=0;e<arrIdsfilas.length;e++)if(arrIdsfilas[e]==a)return e}function eventoCategoria(){$("#IdCategoria").on("change",function(a){var e=parseInt($("#IdCategoria").val());switch(categoria){case 1:$("#tdDatosEspecificosNumeroClaveCatastral").remove();break;case 2:$("#tdDatosEspecificosNumeroChasis").remove(),$("#tdDatosEspecificosNumeroMotor").remove(),$("#tdDatosEspecificosPlaca").remove();break;default:$("#tdDatosEspecificosSerie").remove()}for(var o=0;o<arrIdsfilas.length;o++)try{switch(categoria){case 1:$("#tdNumeroClaveCatastral_"+o).remove();break;case 2:$("#tdNumeroChasis_"+o).remove(),$("#tdNumeroMotor_"+o).remove(),$("#tdPlaca_"+o).remove();break;default:$("#tdSerie_"+o).remove()}}catch(a){}switch(e){case 1:$("<th id='tdDatosEspecificosNumeroClaveCatastral'>"+headerNumeroClaveCatastral+"</th>").insertBefore("#tdDatosEspecificosBodega");break;case 2:$("<th id='tdDatosEspecificosPlaca'>"+headerPlaca+"</th>").insertBefore("#tdDatosEspecificosBodega"),$("<th id='tdDatosEspecificosNumeroMotor'>"+headerNumeroMotor+"</th>").insertBefore("#tdDatosEspecificosPlaca"),$("<th id='tdDatosEspecificosNumeroChasis'>"+headerNumeroChasis+"</th>").insertBefore("#tdDatosEspecificosNumeroMotor");break;default:$("<th id='tdDatosEspecificosSerie'>"+headerSerie+"</th>").insertBefore("#tdDatosEspecificosBodega")}for(o=0;o<arrIdsfilas.length;o++)try{switch(e){case 1:$(crearColumnaVaciaInmueble(o)).insertBefore("#tdBodega_"+o);break;case 2:$(crearColumnaVaciaVehiculo(o)).insertBefore("#tdBodega_"+o);break;default:$(crearColumnaVaciaOtro(o)).insertBefore("#tdBodega_"+o)}}catch(a){}categoria=e})}function crearColumnaVaciaInmueble(a){return"<td id='tdNumeroClaveCatastral_"+a+"'><span id='spanNumeroClaveCatastral_"+a+"'>-</span><input type='hidden' id='hNumeroClaveCatastral_"+a+"'name='hNumeroClaveCatastral_"+a+"'/></td>"}function crearColumnaVaciaVehiculo(a){return"<td id='tdNumeroChasis_"+a+"'><span id='spanNumeroChasis_"+a+"'>-</span><input type='hidden' id='hNumeroChasis_"+a+"'name='hNumeroChasis_"+a+"'/></td><td id='tdNumeroMotor_"+a+"'><span id='spanNumeroMotor_"+a+"'>-</span><input type='hidden' id='hNumeroMotor_"+a+"'name='hNumeroMotor_"+a+"'/></td><td id='tdPlaca_"+a+"'><span id='spanPlaca_"+a+"'>-</span><input type='hidden' id='hPlaca_"+a+"'name='hPlaca_"+a+"'/></td>"}function crearColumnaVaciaOtro(a){return"<td id='tdSerie_"+a+"'><span id='spanSerie_"+a+"'>-</span><input type='hidden' id='hSerie_"+a+"'name='hSerie_"+a+"'/></td>"}function cargarFormularioDatosEspecificos(a){mostrarLoadingPanel("modalContentDatosEspecificos","Cargando datos, por favor espere..."),$("#hIdFilaModalDatosEspecificos").val(a),$("#hIdRecepcionActivoFijoDetalle").val($("#hIdRecepcionActivoFijoDetalle_"+a).val()),$("#hIdUbicacionActivoFijo").val($("#hUbicacion_"+a).val()),$("#myModalLabel").html("Editar"),obtenerCategoria();var e=new Object;switch(categoria){case 1:e.NumeroClaveCatastral=$("#hNumeroClaveCatastral_"+a).val();break;case 2:e.NumeroChasis=$("#hNumeroChasis_"+a).val(),e.NumeroMotor=$("#hNumeroMotor_"+a).val(),e.Placa=$("#hPlaca_"+a).val();break;default:e.Serie=$("#hSerie_"+a).val()}e.IdBodega=$("#hBodega_"+a).val(),e.IdEmpleado=$("#hEmpleado_"+a).val(),$.ajax({url:urlModalDatosEspecificosResult,method:"POST",data:{rafd:e,categoria:categoria,idSucursal:$("#LibroActivoFijo_IdSucursal").val(),idBodega:e.IdBodega,idEmpleado:e.IdEmpleado},success:function(a){$("#modalBodyDatosEspecificos").html(a),Init_Select2(),eventoRadioDatosEspecificos()},error:function(a){mostrarNotificacion("Error","Ocurrió un error al cargar el formulario.")},complete:function(a){$("#modalContentDatosEspecificos").waitMe("hide")}})}function eventoRadioDatosEspecificos(){$(".radioDatosEspecificos").on("change",function(a){switch($(a.currentTarget).data("ubicacion")){case"Bodega":$("#divDatosEspecificosEmpleado").addClass("hide"),$("#divDatosEspecificosBodega").removeClass("hide");break;default:$("#divDatosEspecificosBodega").addClass("hide"),$("#divDatosEspecificosEmpleado").removeClass("hide")}})}function eventoGuardarDatosEspecificos(){$("#btnGuardarDatosEspecificos").on("click",function(a){mostrarLoadingPanel("modalContentDatosEspecificos","Validando datos, por favor espere..."),$.each($(".validationDatosEspecificos"),function(a,e){$(e).html("")});var e=new Object;switch(categoria){case 1:e.NumeroClaveCatastral=$("#NumeroClaveCatastral").val();break;case 2:e.NumeroChasis=$("#NumeroChasis").val(),e.NumeroMotor=$("#NumeroMotor").val(),e.Placa=$("#Placa").val();break;default:e.Serie=$("#Serie").val()}e.IdFila=$("#hIdFilaModalDatosEspecificos").val(),e.IdRecepcionActivoFijoDetalle=$("#hIdRecepcionActivoFijoDetalle").val(),e.IdBodega=$("#IdBodega").val(),e.IdEmpleado=$("#IdEmpleado").val(),e.IsBodega=$("#radioBodegaDatosEspecificos").prop("checked"),validarDatosEspecificosExisten(e)?$.ajax({url:urlValidacionDatosEspecificosResult,method:"POST",data:{rafd:e},success:function(a){if(a.length>0)$.each(a,function(a,e){$("#val"+e.propiedad).html(e.valor)});else{var o=$("#hIdFilaModalDatosEspecificos").val();switch(categoria){case 1:$("#spanNumeroClaveCatastral_"+o).html(formatearDatosEspecifico(e.NumeroClaveCatastral)),$("#hNumeroClaveCatastral_"+o).val(e.NumeroClaveCatastral);break;case 2:$("#spanNumeroChasis_"+o).html(formatearDatosEspecifico(e.NumeroChasis)),$("#hNumeroChasis_"+o).val(e.NumeroChasis),$("#spanNumeroMotor_"+o).html(formatearDatosEspecifico(e.NumeroMotor)),$("#hNumeroMotor_"+o).val(e.NumeroMotor),$("#spanPlaca_"+o).html(formatearDatosEspecifico(e.Placa)),$("#hPlaca_"+o).val(e.Placa);break;default:$("#spanSerie_"+o).html(formatearDatosEspecifico(e.Serie)),$("#hSerie_"+o).val(e.Serie)}if(e.IsBodega)if($("#chkTodosBodegasDatosEspecificos").prop("checked"))for(var i=0;i<arrIdsfilas.length;i++)putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Empleado","-","");else putDatoBodegaEmpleadoFila(o,"Bodega",$("#IdBodega option:selected").text(),$("#IdBodega").val()),putDatoBodegaEmpleadoFila(o,"Empleado","-","");else if($("#chkTodosEmpleadosDatosEspecificos").prop("checked"))for(i=0;i<arrIdsfilas.length;i++)putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(arrIdsfilas[i],"Bodega","-","");else putDatoBodegaEmpleadoFila(o,"Empleado",$("#IdEmpleado option:selected").text(),$("#IdEmpleado").val()),putDatoBodegaEmpleadoFila(o,"Bodega","-","");$("#btnCancelarDatosEspecificos").click()}},error:function(a){mostrarNotificacion("Error","Ocurrió un error al validar el formulario.")},complete:function(a){$("#modalContentDatosEspecificos").waitMe("hide")}}):$("#modalContentDatosEspecificos").waitMe("hide")})}function formatearDatosEspecifico(a){return""==(a=a.toString().trim())&&(a="-"),a}function clearDatosEspecificosBodegaEmpleado(){for(var a=0;a<arrIdsfilas.length;a++)putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Bodega","-",""),putDatoBodegaEmpleadoFila(arrIdsfilas[a],"Empleado","-","")}function putDatoBodegaEmpleadoFila(a,e,o,i){$("#span"+e+"_"+a).html(o),$("#h"+e+"_"+a).val(i)}function validarDatosEspecificosPertenecenBodegaoEmpleado(){for(var a=0;a<arrIdsfilas.length;a++){var e=arrIdsfilas[a],o=$("#hBodega_"+e).val(),i=$("#hEmpleado_"+e).val();if(!(""!=o&&null!=o||""!=i&&null!=i))return!1}return!0}function validarDatosEspecificosExisten(a){for(var e=0;e<arrIdsfilas.length;e++){var o=arrIdsfilas[e];if(a.IdFila!=o)switch(categoria){case 1:if(a.NumeroClaveCatastral==$("#spanNumeroClaveCatastral_"+o).html())return $("#valNumeroClaveCatastral").html("El Número de clave catastral: ya existe."),!1;break;case 2:var i=!0;if(a.NumeroChasis==$("#spanNumeroChasis_"+o).html()&&($("#valNumeroChasis").html("El Número de chasis: ya existe."),i=!1),a.NumeroMotor==$("#spanNumeroMotor_"+o).html()&&($("#valNumeroMotor").html("El Número de motor: ya existe."),i=!1),a.Placa==$("#spanPlaca_"+o).html()&&($("#valPlaca").html("La Placa: ya existe."),i=!1),!i)return!1;break;default:if(a.Serie==$("#spanSerie_"+o).html())return $("#valSerie").html("La Serie: ya existe."),!1}}return!0}function callBackFunctionEliminarDatoEspecifico(a){var e=obtenerPosIdFila(a);$("#trDatosEspecificos_"+arrIdsfilas[e]).remove(),arrIdsfilas.splice(e,1),eliminarComponente(a),$("#RecepcionActivoFijo_Cantidad").val(arrIdsfilas.length),1==arrIdsfilas.length&&$("#divEliminarDatosEspecificos_"+arrIdsfilas[0]).addClass("hide")}$(document).ready(function(){Init_Select2(),Init_Touchspin(),eventoTipoActivoFijo(),eventoClaseActivoFijo(),eventoMarca(),eventoRamo(),eventoSucursal(),gestionarWizard(),Init_DatetimePicker("RecepcionActivoFijo_FechaRecepcion"),Init_FileInput("file"),eventoSpinnerNumeroConsecutivo(),eventoSpinnerCantidad(),initArrIdFilas(),eventoCategoria(),obtenerCategoria(),eventoRadioDatosEspecificos(),eventoGuardarDatosEspecificos()});